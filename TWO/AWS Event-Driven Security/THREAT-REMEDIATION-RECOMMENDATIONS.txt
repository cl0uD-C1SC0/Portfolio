#
# Remediating a compromised EC2 Instance
#

1. Investigate the potentially compromised instance for malware and remove any discovered malware.
2. If you are unable to identify and stop unauthorized activity on your EC2 instance, we recommend that you terminate the compromised EC2 instance 
   and replace it with a new instance as needed. The following are additional resources for securing your EC2 instances:

   * "Security and Network"
        Security:
            - Implement the least permissive rules for your security group.
            - Regularly patch, update, and secure the oprating system and applications on your instance.

        Storage:
            - Understand the implications of the root device type for data persistence, backup, and recovery.
            - Use separate Amazon EBS volumes for the oprating system versus your data. Ensure that the volume with your data persists after instance termination.
            - Use hte instance store available for your instance to store temporary data. Remember that the data stored in instance store is deleted when you stop,
            hibernate, or terminate your instance. If you use instance store for database storage, ensure that you have a cluster with a replication factor that ensusres fault tolerance.
            - Encrypt EBS volumes and snapshots. For more information.

        Resource management:
            - Use instance metadata and custom resource tags to track and identify your AWS resources.
            - View your current limits for Amazon EC2. Plan to request any limit increases in advance of the time that you'll need them.

        Backup and Recovery:
            - Regularly back up your EBS volumes. And create an Amazon Machine Image AMI from your instance to save the configuration as a template for launching future instances.
            - Deploy critical components of your application across multiple Availability Zones, and replicate your data appropriately.
            - Design your applications to handle dynamic IP addressing when your instance restarts.
            - Monitor and respond to events.
            - Ensure that you are prepared to handle failover. For a basic solution, you can manually attach a network interface or Elastic IP address to a replacement instance.
            For automated solution, you can use Amazon EC2 Auto Scaling.
            - Regularly test the process of recovering your instances and Amazon EBS volumes if they fail.
    
        Networking:
            - Set the time-to-live(TTL) value for you applications to 255, for IPv4 and IPv6. If you use a smaller value, thre is a risk that the TTL will expire while
            applications traffic is in transit, causing reachability issues for your instances.
   
   * Tips for Securing your EC2 Instances (Linux):
        - Lock down ports to prevent unauthorized Access
        - Ditch poasswords and require administrators to use SSH keys
        - Keep up to date with software patches. 

    * Infrastructure Domain Incidentes:
        - Capture the metadata from the Amazon EC2 instance, before you make any changes to your environment. 
        - Protect the Amazon EC2 instance from accidental termination by enabling termination protection for the instance 
        - Isolate the Amazon EC2 instance by switching the VPC Security Group.
        - Detach the Amazon EC2 instance from any AWS Auto Scaling groups.
        - Deresgister the Amazon EC2 instance from any related Elastic Load Balancing service. 
        - Snapshot the amazon EBS data volumes that are attached to the EC2 Instance for preservation and follow-up investigations 
        - Tag the Amazon EC2 instance as quarentined for investigation, and add any pertinent metadata, such as the trouble ticket associated with the investigation.