#
# Determine as credenciais comprometidas.
#
Essa task ira ser validada quando
colocarmos o nome correto do usuàrio que teve
as credenciais expostas

> go to cloudtrail
> event history 
> filter: username or aws access key

dicas:

- Verificar os LAMBDAS

- GetSessionToken
- AssumeRole
- GetFederationToken

verifique no iam os possìveis iam users
va no cloudtrail e em insights pesquise pelo usario do iam
Possiveis ações de Lambda...

Podemos verificar os usuarios no IAM e filtrar no cloud trail pelo usuario e ver suas ações

Talvez tenhamos que criar um CloudTrail Trail para monitorar (Com Insights Events ativado fica mais fácil)

Cloudtrail:
    UserIdentity ou userIdentity


se nao tiver acesso ao serviço iam
va no cloudtrail e procure pelos usuarios e procure por events estranhos


se o usuario for root procure por root 

Procure por eventos como:
ConsoleLogin
RunInstances

Se no evento tiver output properties com
as credenciais que foram vazadas
Procure eventos com aquelas credenciais

------------------
The following table shows how CloudTrail logs different information for each of the API calls that generate temporary credentials.

    Principal type:         STS API             User identity in            User identity in                            User identity in CloudTrail
                                                CloudTrail log for          CloudTrail log for                          log for the role's subsequent
                                                caller's account            the assumed role's account                  API Calls
    AWS account 
    root user credentials  GetSessionToken	    Root user identity	   Role owner account is same as calling account	Root user identit

                           GetFederationToken   Iam user identity

                           AssumeRole           Iam user identity

                           AssumeRoleWithSAML   Iam user identity

                           AssumeRoleWithWebIdentity  Iam user Identity



STS API Pode ajudar a mapear

EX:
In Event History
FILTER: Event Name
NAME: GetSessionToken 

DataEvents, podemos filtrar de qual serviço queremos ver logs (iSSO É BOM POIS PODEMOS VER SÓ DO LAMBDA)